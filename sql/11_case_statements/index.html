<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CASE Statements - SQL Learning Hub</title>
    <link rel="stylesheet" href="../../assets/css/main.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>
    <header class="header">
        <div class="container header-content">
            <a href="../../index.html" class="logo"><span>Data Engineering Hub</span></a>
            <nav class="nav"><a href="../../index.html#sql" class="nav-link active">SQL</a><button class="theme-toggle">ðŸŒ™</button></nav>
        </div>
    </header>
    <main class="container">
        <section class="section">
            <h1>CASE Statements</h1>
            <p>CASE provides conditional logic in SQL, similar to if-then-else in programming languages. It can be used in SELECT, WHERE, ORDER BY, and other clauses.</p>
            <div id="visualization" class="visualization-container"></div>
            <div class="visualization-controls">
                <button class="viz-btn" onclick="showCase()">CASE Logic</button>
            </div>
            <h2>Code Examples</h2>
            <div class="tabs">
                <button class="tab active" data-tab="simple">Simple CASE</button>
                <button class="tab" data-tab="searched">Searched CASE</button>
                <button class="tab" data-tab="advanced">Advanced Uses</button>
            </div>
            <div class="tab-contents">
                <div id="simple" class="tab-content active">
                    <div class="code-container">
                        <div class="code-header"><span class="code-language">SQL</span><button class="copy-btn">Copy</button></div>
                        <div class="code-block">
<pre>-- Simple CASE (equality check)
SELECT 
    first_name,
    department_id,
    CASE department_id
        WHEN 10 THEN 'IT'
        WHEN 20 THEN 'HR'
        WHEN 30 THEN 'Finance'
        ELSE 'Other'
    END AS department_name
FROM employees;

-- CASE with NULL handling
SELECT 
    first_name,
    commission_pct,
    CASE commission_pct
        WHEN NULL THEN 'No Commission'  -- Won't work!
        ELSE 'Has Commission'
    END AS status
FROM employees;

-- Correct NULL handling
SELECT 
    first_name,
    CASE 
        WHEN commission_pct IS NULL THEN 'No Commission'
        ELSE 'Has Commission'
    END AS status
FROM employees;</pre>
                        </div>
                    </div>
                </div>
                <div id="searched" class="tab-content">
                    <div class="code-container">
                        <div class="code-header"><span class="code-language">SQL</span><button class="copy-btn">Copy</button></div>
                        <div class="code-block">
<pre>-- Searched CASE (any condition)
SELECT 
    first_name,
    salary,
    CASE 
        WHEN salary >= 100000 THEN 'Executive'
        WHEN salary >= 70000 THEN 'Senior'
        WHEN salary >= 50000 THEN 'Mid-Level'
        WHEN salary >= 30000 THEN 'Junior'
        ELSE 'Entry'
    END AS level
FROM employees;

-- Multiple conditions per WHEN
SELECT 
    first_name,
    CASE 
        WHEN department_id = 10 AND salary > 50000 THEN 'High IT'
        WHEN department_id = 10 THEN 'IT'
        WHEN department_id = 20 THEN 'HR'
        ELSE 'Other'
    END AS category
FROM employees;

-- CASE with functions
SELECT 
    first_name,
    hire_date,
    CASE 
        WHEN EXTRACT(YEAR FROM hire_date) < 2020 THEN 'Veteran'
        WHEN EXTRACT(YEAR FROM hire_date) < 2023 THEN 'Experienced'
        ELSE 'New Hire'
    END AS tenure_category
FROM employees;</pre>
                        </div>
                    </div>
                </div>
                <div id="advanced" class="tab-content">
                    <div class="code-container">
                        <div class="code-header"><span class="code-language">SQL</span><button class="copy-btn">Copy</button></div>
                        <div class="code-block">
<pre>-- CASE in WHERE clause
SELECT * FROM employees
WHERE CASE 
    WHEN department_id = 10 THEN salary > 50000
    WHEN department_id = 20 THEN salary > 40000
    ELSE salary > 30000
END;

-- CASE in ORDER BY
SELECT * FROM employees
ORDER BY CASE status
    WHEN 'Active' THEN 1
    WHEN 'Pending' THEN 2
    WHEN 'Inactive' THEN 3
END;

-- CASE in aggregation (pivot-like)
SELECT 
    department_id,
    SUM(CASE WHEN gender = 'M' THEN 1 ELSE 0 END) AS male_count,
    SUM(CASE WHEN gender = 'F' THEN 1 ELSE 0 END) AS female_count
FROM employees
GROUP BY department_id;

-- Nested CASE
SELECT 
    first_name,
    CASE 
        WHEN department_id = 10 THEN
            CASE WHEN salary > 50000 THEN 'Senior IT' ELSE 'Junior IT' END
        ELSE 'Other'
    END AS category
FROM employees;

-- COALESCE and NULLIF (CASE shortcuts)
SELECT COALESCE(commission, 0) AS commission;  -- First non-null
SELECT NULLIF(value, 0) AS value;  -- NULL if equal</pre>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    <script src="../../assets/js/main.js"></script>
    <script src="../../assets/js/visualization.js"></script>
    <script>
        let viz;
        document.addEventListener('DOMContentLoaded', function() {
            viz = new DataVisualization('visualization', { cameraPosition: { x: 5, y: 3, z: 5 } });
            showCase();
        });
        function showCase() {
            viz.clear();
            viz.createDataNode({ type: 'sphere', size: 0.5, color: 0x4dabf7, position: { x: 0, y: 1.5, z: 0 } });
            viz.createLabel('Input', { x: 0, y: 2.2, z: 0 });
            viz.createArrow({ x: -0.5, y: 1, z: 0 }, { x: -1.5, y: 0.3, z: 0 }, { color: 0x888888 });
            viz.createArrow({ x: 0, y: 1, z: 0 }, { x: 0, y: 0.3, z: 0 }, { color: 0x888888 });
            viz.createArrow({ x: 0.5, y: 1, z: 0 }, { x: 1.5, y: 0.3, z: 0 }, { color: 0x888888 });
            viz.createDataNode({ type: 'cube', size: 0.4, color: 0xe25a1c, position: { x: -1.5, y: 0, z: 0 } });
            viz.createDataNode({ type: 'cube', size: 0.4, color: 0x198754, position: { x: 0, y: 0, z: 0 } });
            viz.createDataNode({ type: 'cube', size: 0.4, color: 0x8b5cf6, position: { x: 1.5, y: 0, z: 0 } });
            viz.createLabel('A', { x: -1.5, y: -0.6, z: 0 });
            viz.createLabel('B', { x: 0, y: -0.6, z: 0 });
            viz.createLabel('C', { x: 1.5, y: -0.6, z: 0 });
            viz.createLabel('CASE - Conditional branching', { x: 0, y: -1.8, z: 0 });
            viz.createGrid(10, 10);
        }
    </script>
</body>
</html>
