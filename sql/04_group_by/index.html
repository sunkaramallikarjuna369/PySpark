<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GROUP BY - SQL Learning Hub</title>
    <link rel="stylesheet" href="../../assets/css/main.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>
    <header class="header">
        <div class="container header-content">
            <a href="../../index.html" class="logo"><span>Data Engineering Hub</span></a>
            <nav class="nav"><a href="../../index.html#sql" class="nav-link active">SQL</a><button class="theme-toggle">ðŸŒ™</button></nav>
        </div>
    </header>
    <main class="container">
        <section class="section">
            <h1>GROUP BY</h1>
            <p>GROUP BY groups rows with the same values into summary rows. It's used with aggregate functions like COUNT, SUM, AVG, MIN, MAX.</p>
            <div id="visualization" class="visualization-container"></div>
            <div class="visualization-controls">
                <button class="viz-btn" onclick="showGroupBy()">GROUP BY</button>
                <button class="viz-btn" onclick="showAggregate()">Aggregates</button>
            </div>
            <h2>Code Examples</h2>
            <div class="tabs">
                <button class="tab active" data-tab="basic">Basic GROUP BY</button>
                <button class="tab" data-tab="aggregates">Aggregate Functions</button>
                <button class="tab" data-tab="advanced">Advanced</button>
            </div>
            <div class="tab-contents">
                <div id="basic" class="tab-content active">
                    <div class="code-container">
                        <div class="code-header"><span class="code-language">SQL</span><button class="copy-btn">Copy</button></div>
                        <div class="code-block">
<pre>-- Basic GROUP BY
SELECT department_id, COUNT(*) AS employee_count
FROM employees
GROUP BY department_id;

-- GROUP BY multiple columns
SELECT department_id, job_id, COUNT(*) AS count
FROM employees
GROUP BY department_id, job_id;

-- GROUP BY with ORDER BY
SELECT department_id, COUNT(*) AS count
FROM employees
GROUP BY department_id
ORDER BY count DESC;

-- GROUP BY with column alias (some databases)
SELECT department_id AS dept, COUNT(*) AS count
FROM employees
GROUP BY dept;  -- MySQL allows this

-- GROUP BY with expression
SELECT 
    YEAR(hire_date) AS hire_year,
    COUNT(*) AS hired_count
FROM employees
GROUP BY YEAR(hire_date);

-- GROUP BY with NULL values (NULL is its own group)
SELECT department_id, COUNT(*)
FROM employees
GROUP BY department_id;</pre>
                        </div>
                    </div>
                </div>
                <div id="aggregates" class="tab-content">
                    <div class="code-container">
                        <div class="code-header"><span class="code-language">SQL</span><button class="copy-btn">Copy</button></div>
                        <div class="code-block">
<pre>-- COUNT
SELECT department_id, COUNT(*) AS total_employees
FROM employees GROUP BY department_id;

-- COUNT DISTINCT
SELECT department_id, COUNT(DISTINCT job_id) AS unique_jobs
FROM employees GROUP BY department_id;

-- SUM
SELECT department_id, SUM(salary) AS total_salary
FROM employees GROUP BY department_id;

-- AVG
SELECT department_id, AVG(salary) AS avg_salary
FROM employees GROUP BY department_id;

-- MIN and MAX
SELECT department_id, 
       MIN(salary) AS min_salary,
       MAX(salary) AS max_salary
FROM employees GROUP BY department_id;

-- Multiple aggregates
SELECT 
    department_id,
    COUNT(*) AS count,
    SUM(salary) AS total,
    AVG(salary) AS average,
    MIN(salary) AS minimum,
    MAX(salary) AS maximum
FROM employees
GROUP BY department_id;

-- STRING_AGG / GROUP_CONCAT (concatenate values)
-- PostgreSQL:
SELECT department_id, STRING_AGG(first_name, ', ')
FROM employees GROUP BY department_id;
-- MySQL:
SELECT department_id, GROUP_CONCAT(first_name)
FROM employees GROUP BY department_id;</pre>
                        </div>
                    </div>
                </div>
                <div id="advanced" class="tab-content">
                    <div class="code-container">
                        <div class="code-header"><span class="code-language">SQL</span><button class="copy-btn">Copy</button></div>
                        <div class="code-block">
<pre>-- ROLLUP (hierarchical subtotals)
SELECT department_id, job_id, SUM(salary)
FROM employees
GROUP BY ROLLUP(department_id, job_id);

-- CUBE (all combinations of subtotals)
SELECT department_id, job_id, SUM(salary)
FROM employees
GROUP BY CUBE(department_id, job_id);

-- GROUPING SETS (specific groupings)
SELECT department_id, job_id, SUM(salary)
FROM employees
GROUP BY GROUPING SETS (
    (department_id, job_id),
    (department_id),
    ()
);

-- GROUPING function (identify subtotal rows)
SELECT 
    department_id,
    job_id,
    SUM(salary),
    GROUPING(department_id) AS is_dept_subtotal,
    GROUPING(job_id) AS is_job_subtotal
FROM employees
GROUP BY ROLLUP(department_id, job_id);

-- Conditional aggregation
SELECT 
    department_id,
    COUNT(CASE WHEN salary > 50000 THEN 1 END) AS high_earners,
    COUNT(CASE WHEN salary <= 50000 THEN 1 END) AS others
FROM employees
GROUP BY department_id;</pre>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    <script src="../../assets/js/main.js"></script>
    <script src="../../assets/js/visualization.js"></script>
    <script>
        let viz;
        document.addEventListener('DOMContentLoaded', function() {
            viz = new DataVisualization('visualization', { cameraPosition: { x: 5, y: 3, z: 5 } });
            showGroupBy();
        });
        function showGroupBy() {
            viz.clear();
            const colors = [0xe25a1c, 0x4dabf7, 0x198754];
            for (let g = 0; g < 3; g++) {
                for (let i = 0; i < 3 - g; i++) {
                    viz.createDataNode({ type: 'cube', size: 0.35, color: colors[g], position: { x: -2 + g * 2, y: 1 - i * 0.6, z: 0 } });
                }
            }
            viz.createLabel('GROUP BY - Group rows by column', { x: 0, y: -2, z: 0 });
            viz.createGrid(10, 10);
        }
        function showAggregate() {
            viz.clear();
            viz.createDataNode({ type: 'cube', size: 0.8, color: 0xe25a1c, position: { x: -1.5, y: 0.5, z: 0 } });
            viz.createDataNode({ type: 'cube', size: 0.8, color: 0x4dabf7, position: { x: 0, y: 0.5, z: 0 } });
            viz.createDataNode({ type: 'cube', size: 0.8, color: 0x198754, position: { x: 1.5, y: 0.5, z: 0 } });
            viz.createLabel('SUM', { x: -1.5, y: 1.5, z: 0 });
            viz.createLabel('AVG', { x: 0, y: 1.5, z: 0 });
            viz.createLabel('COUNT', { x: 1.5, y: 1.5, z: 0 });
            viz.createLabel('Aggregate Functions', { x: 0, y: -1.5, z: 0 });
            viz.createGrid(10, 10);
        }
    </script>
</body>
</html>
