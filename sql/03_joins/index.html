<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JOINs - SQL Learning Hub</title>
    <link rel="stylesheet" href="../../assets/css/main.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>
    <header class="header">
        <div class="container header-content">
            <a href="../../index.html" class="logo"><span>Data Engineering Hub</span></a>
            <nav class="nav"><a href="../../index.html#sql" class="nav-link active">SQL</a><button class="theme-toggle">ðŸŒ™</button></nav>
        </div>
    </header>
    <main class="container">
        <section class="section">
            <h1>SQL JOINs</h1>
            <p>JOINs combine rows from two or more tables based on related columns. Learn different join types using standard SQL, PySpark DataFrame API, and PySpark SQL.</p>
            <div id="visualization" class="visualization-container"></div>
            <div class="visualization-controls">
                <button class="viz-btn" onclick="showInner()">INNER</button>
                <button class="viz-btn" onclick="showLeft()">LEFT</button>
                <button class="viz-btn" onclick="showRight()">RIGHT</button>
                <button class="viz-btn" onclick="showFull()">FULL</button>
            </div>
            <h2>Code Examples</h2>
            <div class="tabs">
                <button class="tab active" data-tab="sql">Standard SQL</button>
                <button class="tab" data-tab="pyspark-df">PySpark DataFrame</button>
                <button class="tab" data-tab="pyspark-sql">PySpark SQL</button>
                <button class="tab" data-tab="comparison">Side-by-Side</button>
            </div>
            <div class="tab-contents">
                <div id="sql" class="tab-content active">
                    <div class="code-container">
                        <div class="code-header"><span class="code-language">SQL</span><button class="copy-btn">Copy</button></div>
                        <div class="code-block">
<pre>-- INNER JOIN - Only matching rows from both tables
SELECT e.employee_id, e.first_name, d.department_name
FROM employees e
INNER JOIN departments d ON e.department_id = d.department_id;

-- LEFT JOIN - All rows from left table, matching from right
SELECT e.first_name, d.department_name
FROM employees e
LEFT JOIN departments d ON e.department_id = d.department_id;

-- RIGHT JOIN - All rows from right table, matching from left
SELECT e.first_name, d.department_name
FROM employees e
RIGHT JOIN departments d ON e.department_id = d.department_id;

-- FULL OUTER JOIN - All rows from both tables
SELECT e.first_name, d.department_name
FROM employees e
FULL OUTER JOIN departments d ON e.department_id = d.department_id;

-- CROSS JOIN - Cartesian product
SELECT e.first_name, d.department_name
FROM employees e CROSS JOIN departments d;

-- Self join
SELECT e.first_name AS employee, m.first_name AS manager
FROM employees e
INNER JOIN employees m ON e.manager_id = m.employee_id;</pre>
                        </div>
                    </div>
                </div>
                <div id="pyspark-df" class="tab-content">
                    <div class="code-container">
                        <div class="code-header"><span class="code-language">Python (PySpark DataFrame API)</span><button class="copy-btn">Copy</button></div>
                        <div class="code-block">
<pre>from pyspark.sql import SparkSession
from pyspark.sql.functions import col

spark = SparkSession.builder.appName("Joins").getOrCreate()

# Create sample DataFrames
employees = spark.createDataFrame([
    (1, "Alice", 10), (2, "Bob", 20), (3, "Charlie", 30), (4, "Diana", None)
], ["emp_id", "name", "dept_id"])

departments = spark.createDataFrame([
    (10, "Engineering"), (20, "Sales"), (40, "Marketing")
], ["dept_id", "dept_name"])

# INNER JOIN - Only matching rows
employees.join(departments, employees.dept_id == departments.dept_id, "inner").show()
# Shorthand when column names match:
employees.join(departments, "dept_id", "inner").show()

# LEFT JOIN - All from left + matches from right
employees.join(departments, "dept_id", "left").show()
employees.join(departments, "dept_id", "left_outer").show()

# RIGHT JOIN - All from right + matches from left
employees.join(departments, "dept_id", "right").show()
employees.join(departments, "dept_id", "right_outer").show()

# FULL OUTER JOIN - All rows from both
employees.join(departments, "dept_id", "outer").show()
employees.join(departments, "dept_id", "full").show()
employees.join(departments, "dept_id", "full_outer").show()

# CROSS JOIN - Cartesian product
employees.crossJoin(departments).show()

# LEFT ANTI JOIN - Rows in left not in right
employees.join(departments, "dept_id", "left_anti").show()

# LEFT SEMI JOIN - Rows in left that have match in right
employees.join(departments, "dept_id", "left_semi").show()

# Multiple join conditions
employees.join(
    departments,
    (employees.dept_id == departments.dept_id) & (employees.emp_id > 1),
    "inner"
).show()

# Self join (employees with managers)
emp_with_mgr = spark.createDataFrame([
    (1, "Alice", None), (2, "Bob", 1), (3, "Charlie", 1)
], ["emp_id", "name", "manager_id"])

emp_with_mgr.alias("e").join(
    emp_with_mgr.alias("m"),
    col("e.manager_id") == col("m.emp_id"),
    "left"
).select("e.name", col("m.name").alias("manager")).show()</pre>
                        </div>
                    </div>
                </div>
                <div id="pyspark-sql" class="tab-content">
                    <div class="code-container">
                        <div class="code-header"><span class="code-language">Python (PySpark SQL)</span><button class="copy-btn">Copy</button></div>
                        <div class="code-block">
<pre>from pyspark.sql import SparkSession

spark = SparkSession.builder.appName("Joins").getOrCreate()

# Create and register temp views
employees = spark.createDataFrame([
    (1, "Alice", 10), (2, "Bob", 20), (3, "Charlie", 30), (4, "Diana", None)
], ["emp_id", "name", "dept_id"])
employees.createOrReplaceTempView("employees")

departments = spark.createDataFrame([
    (10, "Engineering"), (20, "Sales"), (40, "Marketing")
], ["dept_id", "dept_name"])
departments.createOrReplaceTempView("departments")

# INNER JOIN
spark.sql("""
    SELECT e.emp_id, e.name, d.dept_name
    FROM employees e
    INNER JOIN departments d ON e.dept_id = d.dept_id
""").show()

# LEFT JOIN
spark.sql("""
    SELECT e.name, d.dept_name
    FROM employees e
    LEFT JOIN departments d ON e.dept_id = d.dept_id
""").show()

# RIGHT JOIN
spark.sql("""
    SELECT e.name, d.dept_name
    FROM employees e
    RIGHT JOIN departments d ON e.dept_id = d.dept_id
""").show()

# FULL OUTER JOIN
spark.sql("""
    SELECT e.name, d.dept_name
    FROM employees e
    FULL OUTER JOIN departments d ON e.dept_id = d.dept_id
""").show()

# CROSS JOIN
spark.sql("""
    SELECT e.name, d.dept_name
    FROM employees e CROSS JOIN departments d
""").show()

# LEFT ANTI JOIN (employees without departments)
spark.sql("""
    SELECT e.name FROM employees e
    LEFT ANTI JOIN departments d ON e.dept_id = d.dept_id
""").show()

# LEFT SEMI JOIN (employees with departments)
spark.sql("""
    SELECT e.name FROM employees e
    LEFT SEMI JOIN departments d ON e.dept_id = d.dept_id
""").show()</pre>
                        </div>
                    </div>
                </div>
                <div id="comparison" class="tab-content">
                    <div class="code-container">
                        <div class="code-header"><span class="code-language">Side-by-Side Comparison</span><button class="copy-btn">Copy</button></div>
                        <div class="code-block">
<pre># ============================================
# JOINS: DataFrame API vs SQL
# ============================================
from pyspark.sql import SparkSession

spark = SparkSession.builder.appName("Comparison").getOrCreate()

emp = spark.createDataFrame([(1, "Alice", 10), (2, "Bob", 20)], ["id", "name", "dept_id"])
dept = spark.createDataFrame([(10, "Eng"), (30, "HR")], ["dept_id", "dept_name"])
emp.createOrReplaceTempView("emp")
dept.createOrReplaceTempView("dept")

# INNER JOIN
# DataFrame API:
emp.join(dept, "dept_id", "inner").show()
# PySpark SQL:
spark.sql("SELECT * FROM emp e INNER JOIN dept d ON e.dept_id = d.dept_id").show()

# LEFT JOIN
# DataFrame API:
emp.join(dept, "dept_id", "left").show()
# PySpark SQL:
spark.sql("SELECT * FROM emp e LEFT JOIN dept d ON e.dept_id = d.dept_id").show()

# RIGHT JOIN
# DataFrame API:
emp.join(dept, "dept_id", "right").show()
# PySpark SQL:
spark.sql("SELECT * FROM emp e RIGHT JOIN dept d ON e.dept_id = d.dept_id").show()

# FULL OUTER JOIN
# DataFrame API:
emp.join(dept, "dept_id", "outer").show()
# PySpark SQL:
spark.sql("SELECT * FROM emp e FULL OUTER JOIN dept d ON e.dept_id = d.dept_id").show()

# CROSS JOIN
# DataFrame API:
emp.crossJoin(dept).show()
# PySpark SQL:
spark.sql("SELECT * FROM emp CROSS JOIN dept").show()

# LEFT ANTI (not in)
# DataFrame API:
emp.join(dept, "dept_id", "left_anti").show()
# PySpark SQL:
spark.sql("SELECT * FROM emp e LEFT ANTI JOIN dept d ON e.dept_id = d.dept_id").show()</pre>
                        </div>
                    </div>
                </div>
            </div>
            <div style="display: flex; justify-content: space-between; margin-top: 3rem; padding-top: 2rem; border-top: 1px solid var(--border-color);">
                <a href="../02_where_filtering/index.html" style="color: var(--text-muted);">&larr; Previous: WHERE Filtering</a>
                <a href="../04_group_by/index.html" style="color: var(--accent-primary);">Next: GROUP BY &rarr;</a>
            </div>
        </section>
    </main>
    <script src="../../assets/js/main.js"></script>
    <script src="../../assets/js/visualization.js"></script>
    <script>
        let viz;
        document.addEventListener('DOMContentLoaded', function() {
            viz = new DataVisualization('visualization', { cameraPosition: { x: 5, y: 3, z: 5 } });
            showInner();
        });
        function showInner() {
            viz.clear();
            viz.createDataNode({ type: 'sphere', size: 0.8, color: 0x4dabf7, position: { x: -0.8, y: 0.5, z: 0 } });
            viz.createDataNode({ type: 'sphere', size: 0.8, color: 0xe25a1c, position: { x: 0.8, y: 0.5, z: 0 } });
            viz.createDataNode({ type: 'sphere', size: 0.4, color: 0x198754, position: { x: 0, y: 0.5, z: 0 } });
            viz.createLabel('Table A', { x: -1.5, y: 1.5, z: 0 });
            viz.createLabel('Table B', { x: 1.5, y: 1.5, z: 0 });
            viz.createLabel('INNER JOIN - Only matching rows', { x: 0, y: -1.5, z: 0 });
            viz.createGrid(10, 10);
        }
        function showLeft() {
            viz.clear();
            viz.createDataNode({ type: 'sphere', size: 1, color: 0x4dabf7, position: { x: -0.5, y: 0.5, z: 0 } });
            viz.createDataNode({ type: 'sphere', size: 0.6, color: 0xe25a1c, position: { x: 1, y: 0.5, z: 0 } });
            viz.createLabel('LEFT JOIN - All from left + matches', { x: 0, y: -1.5, z: 0 });
            viz.createGrid(10, 10);
        }
        function showRight() {
            viz.clear();
            viz.createDataNode({ type: 'sphere', size: 0.6, color: 0x4dabf7, position: { x: -1, y: 0.5, z: 0 } });
            viz.createDataNode({ type: 'sphere', size: 1, color: 0xe25a1c, position: { x: 0.5, y: 0.5, z: 0 } });
            viz.createLabel('RIGHT JOIN - All from right + matches', { x: 0, y: -1.5, z: 0 });
            viz.createGrid(10, 10);
        }
        function showFull() {
            viz.clear();
            viz.createDataNode({ type: 'sphere', size: 1, color: 0x4dabf7, position: { x: -0.5, y: 0.5, z: 0 } });
            viz.createDataNode({ type: 'sphere', size: 1, color: 0xe25a1c, position: { x: 0.5, y: 0.5, z: 0 } });
            viz.createLabel('FULL OUTER JOIN - All rows from both', { x: 0, y: -1.5, z: 0 });
            viz.createGrid(10, 10);
        }
    </script>
</body>
</html>
