<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snowflake Schema - DW Learning Hub</title>
    <link rel="stylesheet" href="../../assets/css/main.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>
    <header class="header">
        <div class="container header-content">
            <a href="../../index.html" class="logo"><span>Data Engineering Hub</span></a>
            <nav class="nav"><a href="../../index.html#datawarehouse" class="nav-link active">Data Warehouse</a><button class="theme-toggle">ðŸŒ™</button></nav>
        </div>
    </header>
    <main class="container">
        <section class="section">
            <h1>Snowflake Schema</h1>
            <p>Snowflake schema is a normalized version of star schema where dimension tables are further normalized into sub-dimension tables.</p>
            <div id="visualization" class="visualization-container"></div>
            <div class="visualization-controls">
                <button class="viz-btn" onclick="showSnowflake()">Snowflake</button>
                <button class="viz-btn" onclick="showComparison()">vs Star</button>
            </div>
            <h2>Code Examples</h2>
            <div class="tabs">
                <button class="tab active" data-tab="design">Schema Design</button>
                <button class="tab" data-tab="create">Create Tables</button>
                <button class="tab" data-tab="comparison">Comparison</button>
            </div>
            <div class="tab-contents">
                <div id="design" class="tab-content active">
                    <div class="code-container">
                        <div class="code-header"><span class="code-language">Text</span><button class="copy-btn">Copy</button></div>
                        <div class="code-block">
<pre>Snowflake Schema Characteristics:

STRUCTURE:
- Fact table at center (same as star)
- Dimension tables normalized into multiple related tables
- Creates a "snowflake" appearance

EXAMPLE:
Star Schema:
  dim_product (product_key, name, category, subcategory, brand, brand_country)

Snowflake Schema:
  dim_product (product_key, name, category_key, brand_key)
  dim_category (category_key, category_name, subcategory)
  dim_brand (brand_key, brand_name, country_key)
  dim_country (country_key, country_name)

BENEFITS:
1. Reduced data redundancy
2. Lower storage requirements
3. Better data integrity
4. Easier dimension maintenance
5. More normalized structure

DRAWBACKS:
1. More complex queries (more joins)
2. Slower query performance
3. Harder for business users to understand
4. More tables to maintain

WHEN TO USE:
- Storage is a concern
- Dimension data changes frequently
- Need strict data integrity
- Complex hierarchies in dimensions</pre>
                        </div>
                    </div>
                </div>
                <div id="create" class="tab-content">
                    <div class="code-container">
                        <div class="code-header"><span class="code-language">SQL</span><button class="copy-btn">Copy</button></div>
                        <div class="code-block">
<pre>-- Snowflake Schema: Normalized Dimensions

-- Level 3: Country (most normalized)
CREATE TABLE dim_country (
    country_key INT PRIMARY KEY,
    country_name VARCHAR(50),
    region VARCHAR(50),
    continent VARCHAR(50)
);

-- Level 2: State (references Country)
CREATE TABLE dim_state (
    state_key INT PRIMARY KEY,
    state_name VARCHAR(50),
    state_code VARCHAR(5),
    country_key INT REFERENCES dim_country(country_key)
);

-- Level 2: Brand (references Country)
CREATE TABLE dim_brand (
    brand_key INT PRIMARY KEY,
    brand_name VARCHAR(50),
    country_key INT REFERENCES dim_country(country_key)
);

-- Level 2: Category
CREATE TABLE dim_category (
    category_key INT PRIMARY KEY,
    category_name VARCHAR(50),
    department VARCHAR(50)
);

-- Level 1: Product (references Category, Brand)
CREATE TABLE dim_product (
    product_key INT PRIMARY KEY,
    product_id VARCHAR(20),
    product_name VARCHAR(100),
    category_key INT REFERENCES dim_category(category_key),
    brand_key INT REFERENCES dim_brand(brand_key),
    unit_price DECIMAL(10,2)
);

-- Level 1: Customer (references State)
CREATE TABLE dim_customer (
    customer_key INT PRIMARY KEY,
    customer_id VARCHAR(20),
    customer_name VARCHAR(100),
    state_key INT REFERENCES dim_state(state_key)
);

-- Fact Table (same as star schema)
CREATE TABLE fact_sales (
    sale_key INT PRIMARY KEY,
    date_key INT,
    product_key INT REFERENCES dim_product(product_key),
    customer_key INT REFERENCES dim_customer(customer_key),
    quantity INT,
    total_amount DECIMAL(12,2)
);</pre>
                        </div>
                    </div>
                </div>
                <div id="comparison" class="tab-content">
                    <div class="code-container">
                        <div class="code-header"><span class="code-language">SQL</span><button class="copy-btn">Copy</button></div>
                        <div class="code-block">
<pre>-- Star Schema Query (fewer joins)
SELECT 
    p.category,
    p.brand,
    SUM(f.total_amount) as sales
FROM fact_sales f
JOIN dim_product p ON f.product_key = p.product_key
GROUP BY p.category, p.brand;

-- Snowflake Schema Query (more joins)
SELECT 
    c.category_name,
    b.brand_name,
    SUM(f.total_amount) as sales
FROM fact_sales f
JOIN dim_product p ON f.product_key = p.product_key
JOIN dim_category c ON p.category_key = c.category_key
JOIN dim_brand b ON p.brand_key = b.brand_key
GROUP BY c.category_name, b.brand_name;

-- Comparison Summary:
/*
| Aspect          | Star Schema      | Snowflake Schema   |
|-----------------|------------------|---------------------|
| Normalization   | Denormalized     | Normalized          |
| Query Complexity| Simple           | Complex             |
| Query Speed     | Faster           | Slower              |
| Storage         | More             | Less                |
| Redundancy      | High             | Low                 |
| Maintenance     | Harder           | Easier              |
| BI Tool Support | Better           | Requires more setup |
*/</pre>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    <script src="../../assets/js/main.js"></script>
    <script src="../../assets/js/visualization.js"></script>
    <script>
        let viz;
        document.addEventListener('DOMContentLoaded', function() {
            viz = new DataVisualization('visualization', { cameraPosition: { x: 5, y: 3, z: 5 } });
            showSnowflake();
        });
        function showSnowflake() {
            viz.clear();
            // Fact table (center)
            viz.createDataNode({ type: 'cube', size: 0.6, color: 0xe25a1c, position: { x: 0, y: 0.5, z: 0 } });
            viz.createLabel('Fact', { x: 0, y: 1.3, z: 0 });
            // Level 1 dimensions
            const level1 = [
                { name: 'Product', x: -1.5, z: 0 },
                { name: 'Customer', x: 1.5, z: 0 },
                { name: 'Date', x: 0, z: 1.5 }
            ];
            level1.forEach(d => {
                viz.createDataNode({ type: 'cylinder', size: 0.35, color: 0x4dabf7, position: { x: d.x, y: 0.5, z: d.z } });
                viz.createArrow({ x: d.x * 0.6, y: 0.5, z: d.z * 0.6 }, { x: d.x * 0.2, y: 0.5, z: d.z * 0.2 }, { color: 0x888888 });
            });
            // Level 2 dimensions (normalized)
            viz.createDataNode({ type: 'cylinder', size: 0.25, color: 0x198754, position: { x: -2.5, y: 0.5, z: -0.8 } });
            viz.createDataNode({ type: 'cylinder', size: 0.25, color: 0x198754, position: { x: -2.5, y: 0.5, z: 0.8 } });
            viz.createDataNode({ type: 'cylinder', size: 0.25, color: 0x198754, position: { x: 2.5, y: 0.5, z: 0 } });
            viz.createLabel('Snowflake Schema - Normalized Dimensions', { x: 0, y: -1.5, z: 0 });
            viz.createGrid(10, 10);
        }
        function showComparison() {
            viz.clear();
            // Star (left)
            viz.createDataNode({ type: 'cube', size: 0.4, color: 0xe25a1c, position: { x: -1.5, y: 0.5, z: 0 } });
            viz.createLabel('Star', { x: -1.5, y: 1.2, z: 0 });
            for (let i = 0; i < 4; i++) {
                const angle = (i / 4) * Math.PI * 2;
                viz.createDataNode({ type: 'cylinder', size: 0.2, color: 0x4dabf7, position: { x: -1.5 + Math.cos(angle) * 0.8, y: 0.5, z: Math.sin(angle) * 0.8 } });
            }
            // Snowflake (right)
            viz.createDataNode({ type: 'cube', size: 0.4, color: 0xe25a1c, position: { x: 1.5, y: 0.5, z: 0 } });
            viz.createLabel('Snowflake', { x: 1.5, y: 1.2, z: 0 });
            for (let i = 0; i < 4; i++) {
                const angle = (i / 4) * Math.PI * 2;
                viz.createDataNode({ type: 'cylinder', size: 0.15, color: 0x4dabf7, position: { x: 1.5 + Math.cos(angle) * 0.6, y: 0.5, z: Math.sin(angle) * 0.6 } });
                viz.createDataNode({ type: 'cylinder', size: 0.1, color: 0x198754, position: { x: 1.5 + Math.cos(angle) * 1, y: 0.5, z: Math.sin(angle) * 1 } });
            }
            viz.createLabel('Star vs Snowflake Schema', { x: 0, y: -1.5, z: 0 });
            viz.createGrid(10, 10);
        }
    </script>
</body>
</html>
